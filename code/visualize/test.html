<html>
<body>

<canvas id="canv" width=800 height=600 style="border:1px solid #ccc"></canvas>

<script>

var canvas = document.getElementById("canv");
var ctx = canvas.getContext("2d");

var LayerHeight = 100;
var NodeSize = 20;
var NodeGap = 60;
var EdgeWidth = 3;
var MaxWeight = 2;
var MarginX = 20;
var MarginY = 20;

function line(x1, y1, x2, y2, width, color) {
    console.log('line', x1, y1, x2, y2, width, color);
    ctx.beginPath();
    ctx.lineWidth = width;
    ctx.strokeStyle = color;
    ctx.moveTo(x1+MarginX, y1+MarginY);
    ctx.lineTo(x2+MarginX, y2+MarginY);
    ctx.stroke();
}

function rect(x1, y1, x2, y2, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x1+MarginX, y1+MarginY, x2, y2);
}

function edge(layer, n1, n2, weight, isbias) {
    var x1 = n1 * NodeGap;
    var x2 = n2 * NodeGap;
    var y1 = layer * LayerHeight;
    var y2 = y1 + LayerHeight - NodeSize;
    if(isbias) { y1 += LayerHeight/3; }
    
    var r, g, b;
    if(weight >= 0) {
        r = 255;
        g = 255 - weight*255/MaxWeight;
        if(g < 0) { g = 0; }
        b = g;
    }
    else {
        g = 255 + weight*255/MaxWeight;
        if(g < 0) { g = 0; }
        r = g;
        b = 255;
    }
    
    line(x1, y1, x2, y2, EdgeWidth, 'rgb('+r+','+g+','+b+')');
}

function node(layer, n, param) {
    var x1 = n * NodeGap - NodeSize/2;
    var x2 = NodeSize;
    var y1 = layer * LayerHeight - NodeSize;
    var y2 = NodeSize;
    rect(x1, y1, x2, y2, param > .9995 ? '#cfc' : '#fcc');
    line(x1+NodeSize/2, y1+NodeSize/2, x1+NodeSize, y1, 1, '#000');
    line(x1+NodeSize/2, y1+NodeSize/2, x1, y1+NodeSize*(1+param)/2, 1, '#000');
}

function process_data(data) {
    data['edges'].forEach(function(e) {
        if(e[1] == 'bias') {
            edge(e[0], 7, e[2], e[3], true);
        }
        else {
            edge(e[0], e[1], e[2], e[3]);
        }
    });
    data['prelus'].forEach(function(e) {
        node(e[0]+1, e[1], e[2]-0);
    });
}

process_data(
{"prelus":[[0,0,0.99986],[0,1,0.99975],[0,2,0.92392],[0,3,1.00001],[0,4,1.00003],[1,0,1],[1,1,0.99987],[1,2,1],[1,3,1],[1,4,0.99987],[2,0,0.99987],[2,1,1.00002],[2,2,1],[2,3,1],[2,4,0.99987],[3,0,0.92587],[3,1,0.99988],[3,2,1.00003],[3,3,0.99994],[3,4,1.00001]],"edges":[[0,1,2,0.00298],[0,0,2,0.00299],[0,"bias",3,0.03461],[0,0,4,0.1423],[0,1,4,-0.21351],[0,1,1,0.22546],[0,1,3,0.25759],[0,0,1,0.27347],[0,2,3,-0.40802],[0,3,3,-0.45767],[0,0,3,0.55475],[0,3,4,-0.57418],[0,0,0,-0.62372],[0,"bias",4,0.64755],[0,"bias",0,-0.6615],[0,1,0,-0.75064],[0,2,4,-0.77953],[0,3,0,1.36283],[0,2,0,1.40895],[0,"bias",1,-3.7315],[0,2,1,3.82591],[0,3,1,3.87214],[0,2,2,-4.22473],[0,3,2,-4.22483],[0,"bias",2,4.23462],[1,4,4,0.04796],[1,2,3,0.05023],[1,"bias",3,0.07014],[1,1,4,-0.07468],[1,4,2,0.07599],[1,2,4,0.08063],[1,3,3,0.11038],[1,"bias",4,-0.12478],[1,4,3,0.17247],[1,3,0,-0.18157],[1,0,1,-0.21192],[1,3,1,0.2421],[1,"bias",1,-0.29775],[1,0,4,0.30336],[1,1,3,0.34623],[1,"bias",0,-0.38885],[1,3,2,-0.4008],[1,3,4,-0.48586],[1,4,0,-0.48875],[1,"bias",2,-0.51938],[1,0,3,-0.58492],[1,4,1,-0.58614],[1,0,2,0.6912],[1,0,0,1.00177],[1,2,1,1.67826],[1,1,0,1.7038],[1,1,1,1.74223],[1,1,2,1.88248],[1,2,2,1.99165],[1,2,0,2.08721],[2,"bias",4,-0.09037],[2,1,4,-0.09521],[2,3,1,0.13057],[2,2,0,0.13237],[2,4,1,-0.15512],[2,4,2,0.16465],[2,3,2,-0.27864],[2,0,0,0.28186],[2,"bias",3,-0.28728],[2,0,2,-0.29766],[2,3,0,-0.32413],[2,0,3,0.32931],[2,"bias",0,0.40304],[2,2,2,-0.40466],[2,4,4,0.4274],[2,2,3,0.43511],[2,3,4,-0.43855],[2,1,1,-0.43904],[2,4,0,0.47558],[2,4,3,-0.52952],[2,1,2,-0.56615],[2,"bias",1,0.57716],[2,3,3,0.62021],[2,1,0,-0.6955],[2,0,4,0.72883],[2,2,1,-0.73324],[2,2,4,0.7479],[2,"bias",2,0.77924],[2,0,1,-0.86775],[2,1,3,1.26786],[3,"bias",2,-0.01634],[3,4,4,-0.04192],[3,"bias",0,-0.09657],[3,"bias",1,0.09667],[3,"bias",4,-0.10562],[3,"bias",3,-0.13335],[3,1,3,-0.18656],[3,1,2,0.33501],[3,2,3,0.47529],[3,2,2,-0.55307],[3,4,2,-0.59168],[3,3,2,0.59304],[3,0,3,0.64494],[3,1,4,-0.655],[3,2,1,0.68098],[3,0,4,-0.70184],[3,2,4,-0.73468],[3,1,0,0.88479],[3,0,2,-0.90728],[3,3,1,-0.91127],[3,4,3,0.99979],[3,3,3,-1.05653],[3,1,1,-1.15084],[3,2,0,-1.23043],[3,3,4,1.40283],[3,3,0,1.81346],[3,0,1,1.9628],[3,4,1,2.13249],[3,4,0,-2.36998],[3,0,0,-2.4358],[4,0,1,-0.00073],[4,"bias",2,0.01065],[4,3,1,0.01289],[4,1,1,-0.16859],[4,2,1,0.2866],[4,3,2,0.40793],[4,4,1,-0.58391],[4,4,2,-0.63971],[4,"bias",0,0.70313],[4,2,2,-0.7651],[4,2,0,1.10484],[4,4,0,1.18769],[4,"bias",1,1.30494],[4,1,2,1.43127],[4,3,0,-1.56631],[4,0,2,1.83583],[4,1,0,-2.8609],[4,0,0,-3.67125]]}
);


</script>

</body>
</html>
